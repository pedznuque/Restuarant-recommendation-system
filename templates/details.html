<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restaurant Details</title>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <link rel="stylesheet" href="/static/details.css">
</head>


<body>

  <header>
    <div class="logo">
      <img src="https://www.linkpicture.com/q/linkedin_banner_image_1.png" alt="">
    </div>
    <nav>
      <ul>
        {% if 'username' in session %}
        <li><a href="{{ url_for('index') }}">HOME</a></li>
        <li><a href="#">{{ session['username'] }}!</a></li>
        <li><a href="/logout">LOG OUT</a></li>
        {% else %}
        <li><a href="{{ url_for('index') }}">HOME</a></li>
        <li><a href="/login">LOG-IN</a></li>
        <li><a href="/register">SIGN-IN</a></li>
        {% endif %}
      </ul>
    </nav>
  </header>




      <div class="container">
        
            <div class="image_layer"><!------Number 1 layer------>

                  <div class="resto_image_1"> <!------1------>
                      <img src="{{ restaurant.large_image_url }}" alt="">
                  </div>
                  <div class="resto_image_2">

                      <div class="map">MAP IS TEMPORARILY UNAVAILABLE</div>

                  </div>
              
            </div>

            <div class="details_layer"><!------Number 2 layer------>
                    
                      <div class="resto_name_address_city_box">

                          <div class="resto_name_BOX"><div class="resto_name">{{ restaurant.name }}</div></div>
                          <div class="address_BOX"><div class="address"> <span>{{ restaurant.address }}</span></div></div>    
                         

                      </div>

                      

                      <div class="rating_cuisine_bookmark_direction">
                          <div class="rating_and_cuisine_box">

                                <div class="rating_box"><div class="rating"><img src="https://img.icons8.com/ios/256/star--v1.png" alt="">{{ restaurant.rating }}</div></div>
                                <div class="cuisine_box"><div class="cuisine_type"><img src="https://img.icons8.com/ios/256/food-and-wine.png" alt=""> {{ restaurant.cuisine_type }}</div></div>

                          </div> 

                          <div class="bookmark_direction_share_box">
                            <div class="Bookmark">
                            <form id="bookmark-form">
                              <input type="hidden" name="resto_id" value="{{ restaurant.resto_id }}">
                              <input type="hidden" name="name" value="{{ restaurant.name }}">
                              <input type="hidden" name="location" value="{{ restaurant.location }}">
                              <input type="hidden" name="cuisine_type" value="{{ restaurant.cuisine_type }}">
                              <input type="hidden" name="image_url" value="{{ restaurant.image_url }}">
                              <button type="submit"{% if is_bookmarked %} disabled{% endif %}>Save <img src="https://cdn-icons-png.flaticon.com/512/5662/5662990.png" alt=""></button>
                          </form>
                          </div>

                          <div class="Direction">
                          <form action="">

                            <button type="">Direction <img src="https://cdn-icons-png.flaticon.com/512/3313/3313867.png" alt=""></button>

                          </form>
                          </div>

                          <div class="Share">
                          <form action="">

                            <button type="submit">Share <img src="https://cdn-icons-png.flaticon.com/512/2958/2958783.png" alt=""></button>

                          </form>
                          </div>
                          

                          </div>    
                      </div>
                  
            </div>

            <div class="reviews_and_map_layer"><!------Number 3 layer------>
                    <div class="map_layer">

                  
                      
                      

                    </div>     
              
                      <div class="insert_comment_section"><!------INSERT COMMENTS---->


                              <div class="insert_comment_section_BOX">

                                    <div class="username_icon_BOX"><div class="username_icon"><img src="https://cdn-icons-png.flaticon.com/512/1144/1144709.png" alt=""></div></div>
                                    
                                    

                                                                      <div class="write_a_comment">
                                                                        <form id="comment-form" method="POST" action="/details?name={{ restaurant.resto_id }}">
                                                                        <div class="input_box"><textarea id="comment" name="comment" maxlength="280" placeholder="Add a comment"></textarea></div>
                                                                        <div class="submit_box">
                                                                            <div class="null"></div>
                                                                            <div class="submit"><input type="submit" name="comment" id="submit" value="comment"></div>
                                                                      
                                                                        </div>
                                                                      </form>
                                                                      </div>
                                                               
                                                                <br>
                                                                      
                              </div>      

                              <div class="review_section_BOX"><!------READ COMMENTS---->

                                     
                                <div class="all_comments">
                                  {% if reviews %}
                                  {% for review in reviews %}
                                      <div class="review" data-review-id="{{ review[0] }}">
                                        <div class="profile">  <div class="user_icon_for_review_BOX"><div class="user_icon_for_review"><img src="https://cdn-icons-png.flaticon.com/512/1144/1144709.png" alt=""></div></div>
                                        <div class="username"><p>{{ review[1] }}</p><div class="date" data-date="{{ review[3] }}"></div></div>
                                        <div class="null1"></div>
                                        


                                          {% if review[1] == session['username'] %}
                                                <div class="dropdown">
                                                  <button class="dropbtn">&#8942;</button>
                                                  <div class="dropdown-content">
                                                    <form class="delete-form" action="/delete_review/{{ restaurant.name }}" method="POST">
                                                      <input type="hidden" name="review_id" value="{{ review[0] }}">
                                                      <button type="submit" class="delete-btn">Delete</button>
                                                    </form>
                                                  </div>
                                                </div>
                                              {% endif %}
                                              </div>
                                          <div class="comment_box">
                                              
                                              <div class="comment"><p>{{ review[2] }}</p></div>                                                                                          </div>
                                      </div>
                                      
                                  {% endfor %}

                            
                              {% else %}
                                  <p>No reviews yet.</p>
                              {% endif %}
                            </div>               
                                    
                              </div>
                        </div>     

                       



            </div>
              
                        
          </div>

        
      </div>



</body>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

<script>
$(function() {
  $('#comment-form').submit(function(event) {
    // Prevent default form submission
    event.preventDefault();

    // Get the comment input value
    var commentInput = $('#comment');
    var comment = commentInput.val();

    // Check if the comment is empty
    if (comment.length === 0) {
      // Show an error message
      alert('Comment cannot be empty');
      return;
    }

    // Get the form data
    var formData = $(this).serialize();

    // Submit the form data asynchronously
    $.ajax({
      type: 'POST',
      url: $(this).attr('action'),
      data: formData,
      success: function(response) {
        // Handle the successful response
        if (response === 'success') {
          // Reload the page to show the new comment
          window.location.reload();
        }
      },
      error: function() {
        // Handle the error
      }
    });
  });
});
$(function() {
  $('.delete-form').submit(function(event) {
    // Prevent default form submission
    event.preventDefault();

    // Get the form data
    var formData = $(this).serialize();

    // Assign 'this' to a variable for use in success callback
    var $form = $(this);

    // Ask for confirmation before submitting the form
    if (confirm('Are you sure you want to delete this review?')) {
      // Submit the form data asynchronously
      $.ajax({
        type: 'POST',
        url: $form.attr('action'),
        data: formData,
        success: function(response) {
          // Handle the successful response
          if (response.success) {
            // Remove the deleted review from the page
            var reviewId = $form.closest('.review').data('review-id');
            $('[data-review-id="' + reviewId + '"]').remove();
          }
        },
        error: function() {
          // Handle the error
        }
      });
    }
  });
});

document.querySelectorAll('.dropdown').forEach(function(dropdown) {
  dropdown.addEventListener('click', function(e) {
    e.stopPropagation(); // stop propagation of event
    dropdown.classList.toggle('open'); // toggle open class to show/hide dropdown content
  });
});

/* close dropdown when user clicks anywhere outside of it */
document.addEventListener('click', function(e) {
  document.querySelectorAll('.dropdown').forEach(function(dropdown) {
    if (!dropdown.contains(e.target)) {
      dropdown.classList.remove('open');
    }
  });
});


document.getElementById('bookmark-form').addEventListener('submit', function(event) {
        event.preventDefault(); // Prevent the form from submitting normally
        var xhr = new XMLHttpRequest();
        xhr.open('POST', '/bookmark');
        xhr.onload = function() {
            if (xhr.status === 200 && xhr.responseText === 'success') {
                alert('Bookmark added successfully!');
            } else {
                alert('Bookmark could not be added.');
            }
        };
        xhr.send(new FormData(event.target));
    });

    const dateElements = document.querySelectorAll('.date');
  const timezoneOffset = new Date().getTimezoneOffset() * 60 * 1000; // get the timezone offset in milliseconds

  dateElements.forEach((el) => {
    const dateString = el.getAttribute('data-date');
    const date = new Date(dateString);
    const localDate = new Date(date.getTime() - timezoneOffset); // adjust the date to the local timezone
    const now = new Date();
    const diff = now - localDate;

    if (diff < 60 * 1000) {
      el.innerHTML = 'just now';
    } else if (diff < 60 * 60 * 1000) {
      const minutes = Math.floor(diff / (60 * 1000));
      el.innerHTML = `${minutes}m ago`;
    } else if (diff < 24 * 60 * 60 * 1000) {
      const hours = Math.floor(diff / (60 * 60 * 1000));
      el.innerHTML = `${hours}h ago`;
    } else {
      const days = Math.floor(diff / (24 * 60 * 60 * 1000));
      el.innerHTML = `${days}d ago`;
    }
  });

  function openTab(evt, tabName) {
  var i, tabcontent, tablinks;
  
  tabcontent = document.getElementsByClassName("tabcontent");
  for (i = 0; i < tabcontent.length; i++) {
    tabcontent[i].style.display = "none";
  }
  
  tablinks = document.getElementsByClassName("tablink");
  for (i = 0; i < tablinks.length; i++) {
    tablinks[i].className = tablinks[i].className.replace(" active", "");
  }
  
  document.getElementById(tabName).style.display = "block";
  evt.currentTarget.className += " active";
}

document.getElementById("defaultOpen").click();



</script>



</html>

